{"version":3,"sources":["scripts/vesselTypeClasses.js","scripts/onglet1.js","scripts/preprocess.js","scripts/heatmap.js","scripts/chord.js","index.js"],"names":["vesselTypeClasses","build","div","bounds","d3","select","node","getBoundingClientRect","margin","top","right","bottom","left","width","height","svg","append","attr","csv","d","date","timeParse","Other","Tugs","Fishing","Barges","Tanker","PleasureCrafts","Excursion","Merchant","then","data","keys","columns","slice","color","scaleOrdinal","domain","range","schemeSet2","stackedData","stack","x","scaleTime","extent","call","axisBottom","ticks","text","y","scaleLinear","axisLeft","areaChart","area","y0","y1","selectAll","enter","key","style","highlight","_","noHighlight","size","sort","i","on","GLOBAL_VESSEL_TYPE","REGION_NAME","REGION_COLOR","REGION_NAME_ALT","heatmapMap","map","Map","forEach","region","type","set","chordMatrix","departureDate","arrivalDate","matrix","Array","length","index","departureRegion","arrivalRegion","j","filter","value","count","reduce","partialSum","v","Number","buildHeatmap","startDate","endDate","window","innerWidth","myGroups","preproc","myVars","scaleBand","padding","myColor","transformData","line","keyStart","keyStop","current","get","p","max","from","values","push","Region","Type","transformedData","rectSelect","rectUnselect","bandwidth","initLegend","drawLegend","element","toFixed","remove","colorScale","defs","linearGradient","tick","nodes","offset","join","fill","scale","axis","axisRight","rebuild","chordWidth","outerRadius","innerRadius","colors","tooltip","res","chordDirected","padAngle","sortSubgroups","descending","links","datum","ribbonArrow","radius","source","target","event","pageX","pageY","groups","arc","highlightGroup","unhighlightGroup","startAngle","Math","PI","eventData","chordData","stackData","onglet1","chord","time_graph","heatmap","$","click","hasClass","tab","classed","removeClass","addClass","traffic","ndx","crossfilter","vesselTraffic","dimension","timeMonth","vesselTraffics","group","reduceSum","minDate","maxDate","timeScale","rangeRound","vesselTrafficChart","dc","BarChart","margins","round","brushOn","elasticY","yAxis","render","selection","startString","endString","toISOString","split","start","invert","end"],"mappings":"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","file":"INF8808-Projet.5061bf51.js","sourceRoot":"..","sourcesContent":["export function vesselTypeClasses() {\n    return [\n        \"Barges\",\n        \"Excursion\",\n        \"Fishing\",\n        \"Merchant\",\n        \"Other\",\n        \"PleasureCrafts\",\n        \"Tanker\",\n        \"Tugs\",\n        \"Other\"\n    ]\n}","import { vesselTypeClasses } from './vesselTypeClasses.js'\n\n// Source : https://d3-graph-gallery.com/graph/stackedarea_template.html\nexport function build(div) {\n  // set the dimensions and margins of the graph\n  const bounds = d3.select('#stacked-area-chart').node().getBoundingClientRect()\n  const margin = {\n    top: 60, \n    right: 230, \n    bottom: 50, \n    left: 70\n  }\n  const width = bounds.width - margin.left - margin.right\n  const height = 650 - margin.top - margin.bottom\n\n  // create the svg area\n  var svg = div.select(\"#stacked-area-chart\")\n  .append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\",`translate(${margin.left},${margin.top})`)\n\n  // read and transform data\n  d3.csv('./TRIP_STACK_HALF_MONTH.csv', function(d){\n      return { \n        date : d3.timeParse(\"%Y-%m-%d\")(d.date),\n        Other : d.Other,\n        Tugs : d.Tugs,\n        Fishing : d.Fishing,\n        Barges : d.Barges,\n        Tanker : d.Tanker,\n        PleasureCrafts: d.PleasureCrafts,\n        Excursion : d.Excursion,\n        Merchant : d.Merchant,\n      }\n  }).then(function(data) {\n    const keys = data.columns.slice(1)  // list of Vessel Types = header of the csv files\n\n    const color = d3.scaleOrdinal()\n      .domain(vesselTypeClasses())\n      .range(d3.schemeSet2)\n\n    const stackedData = d3.stack()\n      .keys(keys)\n    (data)\n\n    // Add X axis\n    const x = d3.scaleTime()\n      .domain(d3.extent(data, d => d.date))\n      .range([ 0, width ])\n    svg.append(\"g\")\n      .attr(\"transform\", \"translate(0,\" + height + \")\")\n      .call(d3.axisBottom(x).ticks(10))\n\n    // Add X axis label:\n    svg.append(\"text\")\n      .attr(\"text-anchor\", \"end\")\n      .attr(\"x\", width)\n      .attr(\"y\", height+40 )\n      .text(\"Temps\")\n\n    // Add Y axis\n    const y = d3.scaleLinear()\n      .domain([0, 12000])\n      .range([ height, 0 ])\n    svg.append(\"g\")\n      .call(d3.axisLeft(y).ticks(15))\n\n    // Add Y axis label:\n    svg.append(\"text\")\n      .attr(\"text-anchor\", \"end\")\n      .attr(\"x\", 0)\n      .attr(\"y\", -20 )\n      .text(\"Nombre de navires\")\n      .attr(\"text-anchor\", \"start\")\n\n    // Area generator\n    const areaChart = svg.append('g')\n    const area = d3.area()\n      .x(function(d) { return x(d.data.date) })\n      .y0(function(d) { return y(d[0]) })\n      .y1(function(d) { return y(d[1]) })\n\n    // Show the areas\n    areaChart\n    .selectAll(\"mylayers\")\n    .data(stackedData)\n    .enter()\n    .append(\"path\")\n      .attr(\"class\", function(d) { return \"myArea \" + d.key })\n      .style(\"fill\", function(d) { return color(d.key) })\n      .attr(\"d\", area)\n\n    // What to do when one group is hovered\n    const highlight = function(_, d) {\n      d3.selectAll(\".myArea\").style(\"opacity\", .1)  // reduce opacity of all groups\n      d3.select(\".\"+d).style(\"opacity\", 1)  // expect the one that is hovered\n    }\n\n    // And when it is not hovered anymore\n    const noHighlight = function(){\n      d3.selectAll(\".myArea\").style(\"opacity\", 1)\n    }\n\n    // LEGEND //\n    const size = 20\n    svg.selectAll(\"myrect\")   // Add one dot in the legend for each name.\n      .data(keys.sort())\n      .enter()\n      .append(\"rect\")\n        .attr(\"x\", width)\n        .attr(\"y\", function(_,i){ return 10 + i*(size+5)}) // 100 is where the first dot appears. 25 is the distance between dots\n        .attr(\"width\", size)\n        .attr(\"height\", size)\n        .attr(\"rx\", 4)\n        .attr(\"ry\", 4)\n        .style(\"fill\", function(d){ return color(d)})\n        .on(\"mouseover\", highlight)\n        .on(\"mouseleave\", noHighlight)\n\n    svg.selectAll(\"mylabels\")   // Add legend name.\n      .data(keys.sort())\n      .enter()\n      .append(\"text\")\n        .attr(\"x\", width + size*1.2)\n        .attr(\"y\", function(_,i){ return 10 + i*(size+5) + (size/2)}) // 100 is where the first dot appears. 25 is the distance between dots\n        .style(\"fill\", function(d){ return color(d)})\n        .text(function(d){ return d})\n        .attr(\"text-anchor\", \"left\")\n        .style(\"alignment-baseline\", \"middle\")\n        .on(\"mouseover\", highlight)\n        .on(\"mouseleave\", noHighlight)\n    })\n}\n","export const GLOBAL_VESSEL_TYPE = ['Barges', 'Excursion', 'Fishing', 'Merchant', 'Other', 'Pleasure Crafts', 'Tanker', 'Tugs']\nexport const REGION_NAME = ['Arctic', 'Central', 'East Canadian Water', 'Newfoundland', 'Maritimes', 'Pacific', 'Quebec', 'St. Lawrence Seaway', 'West Canadian Water']\nexport const REGION_COLOR = ['#CAB2D6', '#6A3D9A', '#33A02C', '#FB9A99', '#FDBF6F', '#E31A1C', '#1F78B4', '#A6CEE3', '#FF7F00']\nexport const REGION_NAME_ALT = ['Arctic', 'Central', 'East_Canadian_Water', 'Newfoundland', 'Maritimes', 'Pacific', 'Quebec', 'St_Lawrence_Seaway', 'West_Canadian_Water']\n\nexport function heatmapMap() {\n  let map = new Map()\n\n  REGION_NAME.forEach((region) => {\n    GLOBAL_VESSEL_TYPE.forEach((type) => {\n      const key = region + type\n      map.set(key, {\n        'Region': region,\n        'Type': type,\n        'count': 0\n      })\n    })\n  })\n  return map\n}\n\nexport function chordMatrix(data, departureDate, arrivalDate) {\n  const matrix = new Array(REGION_NAME.length)\n  for (let index = 0; index < matrix.length; index++) {\n    matrix[index] = new Array(REGION_NAME.length)\n  }\n  \n  REGION_NAME.forEach((departureRegion, i) => {\n    REGION_NAME.forEach((arrivalRegion, j) => {\n      matrix[i][j] = data\n        .filter((d) => {\n          return departureRegion === d['Departure Region'].slice(0,-7)\n            && arrivalRegion === d['Arrival Region'].slice(0,-7)\n            && departureDate <= d['Departure Date']\n            && arrivalDate >= d['Arrival Date']\n        })\n        .map((value) => value.count)\n        .reduce((partialSum, v) => Number(partialSum) + Number(v), 0)\n    })\n  })\n\n  return matrix\n}","import * as preproc from './preprocess.js'\n\n// Source : https://d3-graph-gallery.com/heatmap.html\nexport function buildHeatmap(div, startDate, endDate) {\n  // set the dimensions and margins of the graph\n  const size = 0.28*window.innerWidth\n  const margin = {\n    top: 10,\n    right: 5, \n    bottom: 90, \n    left: 115\n  }\n  const width = size - margin.left - margin.right\n  const height = size - margin.top - margin.bottom\n\n  // append the svg object to the body of the page\n  const svg = div.select(\"#tab-3-heatmap\")\n  .append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right + 50)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\n\n  // Labels of row and columns\n  const myGroups = preproc.GLOBAL_VESSEL_TYPE\n  const myVars = preproc.REGION_NAME\n\n  // Build X scales and axis:\n  const x = d3.scaleBand()\n    .range([ 0, width ])\n    .domain(myGroups)\n    .padding(0.01)\n\n  svg.append(\"g\")\n    .attr(\"transform\", `translate(0, ${height})`)\n    .call(d3.axisBottom(x))\n    .selectAll('text')\n    .attr('transform', 'translate(-20,20)rotate(-45)')\n\n  // Build Y scales and axis:\n  const y = d3.scaleBand()\n    .range([ height, 0 ])\n    .domain(myVars)\n    .padding(0.01)\n  svg.append(\"g\")\n    .call(d3.axisLeft(y))\n\n  // Build color scale\n  const myColor = d3.scaleLinear()\n    .range([\"white\", \"#ff0000\"])\n\n\n  function transformData(d, departureDate, arrivalDate) {\n    let map = preproc.heatmapMap()\n\n    const data = d.filter((line) => {\n      return departureDate <= line['Departure Date'] && arrivalDate >= line['Arrival Date']\n    })\n\n    // Count the number of vessel of certain region and type\n    data.forEach(line => {\n      const keyStart = line['Departure Region'].slice(0,-7)+line['Global Vessel Type']\n      const keyStop = line['Arrival Region'].slice(0,-7)+line['Global Vessel Type']\n\n      let current = map.get(keyStart)\n      current.count += 1\n      map.set(keyStart, current)\n\n      current = map.get(keyStop)\n      current.count += 1\n      map.set(keyStop, current)\n    })\n\n    // Convert the number of vessel to percentage\n    const p = []\n    let max = 0\n    Array.from(map.values()).forEach((value) => {\n      p.push({\n        'Region': value.Region,\n        'Type': value.Type,\n        'count' : (value.count / (2*data.length)) * 100\n      })\n      if ((value.count / (2*data.length)) * 100 >= max) {\n        max = (value.count / (2*data.length)) * 100\n      }\n    })\n\n    myColor.domain([0,max])   // Update color scale\n\n    return p\n  }\n\n  //Read the data\n  d3.csv(\"./TRIP_HEATMAP.csv\").then(function(data) {\n    // add the squares and interaction\n    const transformedData = transformData(data, startDate, endDate)\n    svg.selectAll()\n    .data(transformedData, function(d) {\n      return d.Type+':'+d.Region\n    })\n    .enter()\n    .append(\"g\")\n      .attr(\"class\", \"square\")\n      .on('mouseenter', function() { rectSelect(this, x, y) })\n      .on('mouseleave', function() { rectUnselect(this) })\n    .append(\"rect\")\n      .attr(\"x\", function(d) { return x(d.Type) })\n      .attr(\"y\", function(d) { return y(d.Region) })\n      .attr(\"width\", x.bandwidth() )\n      .attr(\"height\", y.bandwidth() )\n      .style(\"fill\", function(d) { return myColor(d.count) })\n    \n    // add legend\n    initLegend(svg,myColor)\n    drawLegend(width + margin.right + 10, 0, height, 15, 'url(#gradient)', myColor)\n  })\n}\n\nfunction rectSelect(element, x, y) {\n  d3.select(element)\n    .append(\"text\")\n    .attr('x', function(d) { return x(d.Type) + x.bandwidth() / 2 })\n    .attr('y', function(d) { return y(d.Region) + y.bandwidth() / 2 })\n    .attr('text-anchor', 'middle')\n    .attr('dominant-baseline', 'middle')\n    .text(function(d) {\n      return d.count.toFixed(2) + '%'\n    })\n}\n\nfunction rectUnselect(element) {\n  d3.select(element)\n    .select('text')\n    .remove()\n}\n\nfunction initLegend(svg, colorScale) {\n  const defs = svg.append('defs')\n  svg.append('rect').attr('class', 'legend bar')\n  svg.append('g').attr('class', 'legend axis')\n\n  const linearGradient = defs\n  .append('linearGradient')\n    .attr('id', 'gradient')\n    .attr('x1', 0).attr('y1', 1).attr('x2', 0).attr('y2', 0)\n\n  linearGradient.selectAll('stop')\n  .data(colorScale.ticks().map((tick, i, nodes) => (\n    {\n      offset: `${ (100*i / nodes.length)}%`,\n      color: colorScale(tick)\n    })))\n  .join('stop')\n    .attr('offset', d => d.offset)\n    .attr('stop-color', d => d.color)\n}\n\nfunction drawLegend(x, y, height, width, fill, colorScale) {\n  d3.select('.legend.bar')\n    .attr('fill', fill)\n    .attr('x', x)\n    .attr('y', y)\n    .attr('height', height)\n    .attr('width', width)\n    \n  const scale = d3.scaleLinear()\n    .domain(colorScale.domain())\n    .range([height, 0])\n\n  let axis = d3.axisRight()\n    .ticks(7)\n    .scale(scale)\n\n  d3.select('.legend.axis')\n  .call(axis)\n    .attr('transform', `translate(${x+15}, ${y})`)\n}\n\nexport function rebuild(div, startDate, endDate) {\n  div.select(\"#tab-3-heatmap\")\n    .select('svg')\n    .remove()\n\n  buildHeatmap(div, startDate, endDate)\n}","import * as preproc from './preprocess.js'\n\n// Source : \n// https://d3-graph-gallery.com/chord.html\n// https://observablehq.com/@d3/directed-chord-diagram\n// https://jyu-theartofml.github.io/posts/circos_plot\n// http://strongriley.github.io/d3/ex/chord.html\nexport function build(div, data, startDate, endDate) {\n  // set the dimensions and margins of the graph\n  const chordWidth = window.innerWidth / 2\n\n  const margin = {\n    top: chordWidth*0.175,\n    right: chordWidth*0.05, \n    bottom: chordWidth*0.07,\n    left: chordWidth*0.20 \n  }\n  const width = chordWidth - margin.left - margin.right\n  const height = chordWidth - margin.top - margin.bottom\n\n  const outerRadius = width/3.5\n  const innerRadius = outerRadius-10\n\n  // create the svg area\n  const svg = div.select('#tab-3-chord-diagram')\n  .append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\", `translate(${margin.left+outerRadius},${margin.top+outerRadius})`)\n\n  // create input data: a square matrix that provides flow between entities\n  const matrix = preproc.chordMatrix(data, startDate, endDate)\n  \n  const colors = preproc.REGION_COLOR\n  \n  const tooltip = d3.select('#tooltip-chord-container')\n\n  // give this matrix to d3.chord(): it will calculates all the info we need to draw arc and ribbon\n  const res = d3.chordDirected()\n    .padAngle(0.05)     // padding between entities (black arc)\n    .sortSubgroups(d3.descending)\n    (matrix)\n\n  // add the links between groups\n  const links = svg\n  .datum(res)\n  .append(\"g\")\n    .attr(\"id\", \"links\")\n  .selectAll(\"path\")\n  .data(function(d) { return d; })\n  .enter()\n  .append(\"path\")\n    .attr(\"class\", \"chord\")\n    .attr(\"d\", d3.ribbonArrow().radius(innerRadius))\n    .attr(\"opacity\", 0.5)\n    .style(\"fill\", function(d){ return(colors[d.source.index]) }) // colors depend on the source group\n    .style(\"stroke\", \"black\")\n    .on('mouseenter', function(_, d) {\n      tooltip.select('span#tooltip-chord-region-from-text')\n        .text(preproc.REGION_NAME[d.source.index])\n        .style('color', colors[d.source.index])\n      tooltip.select('span#tooltip-chord-region-to-text')\n        .text(preproc.REGION_NAME[d.target.index])\n        .style('color', colors[d.target.index])\n      tooltip.select('span#tooltip-chord-value')\n        .text(d.source.value)\n      return tooltip.style(\"visibility\", \"visible\")\n    })\n    .on('mousemove', function(event, _) {\n      tooltip.style('left', event.pageX - 246)\n      tooltip.style('top', event.pageY + 5)\n    })\n    .on('mouseleave', function() { return tooltip.style(\"visibility\", \"hidden\") })\n\n  // add the groups on the outer part of the circle\n  svg.datum(res)\n    .append(\"g\")\n      .attr(\"id\", \"groups\")\n    .selectAll(\"g\")\n    .data(function(d) { return d.groups; })\n    .enter()\n    .append(\"g\")\n      .attr(\"class\", \"group\")\n    .append(\"path\")\n      .style(\"fill\", function(_,i){ return colors[i] })\n      .style(\"stroke\", \"black\")\n      .attr(\"d\", d3.arc()\n        .innerRadius(innerRadius)\n        .outerRadius(outerRadius)\n      )\n      .on(\"mouseover\", function(_, d) { highlightGroup(d, links) })\n      .on(\"mouseleave\", function() { unhighlightGroup(links) })\n\n  // add the label of groups\n  svg.datum(res)\n    .append(\"g\")\n    .attr(\"id\", \"labels\")\n    .selectAll(\"text\")\n    .data(function(d) { return d.groups; })\n    .enter()\n    .append(\"g\")\n      .attr(\"transform\", function(d) { return `rotate(${d.startAngle * 180 / Math.PI - 90}) translate(${outerRadius},0)` })\n    .append(\"text\")\n      .attr(\"x\", 8)\n      .attr(\"dy\", \".25em\")\n      .attr(\"transform\", function(d) { return d.startAngle > Math.PI ? \"rotate(180) translate(-16)\" : null })\n      .style(\"text-anchor\", function(d) { return d.startAngle > Math.PI ? \"end\" : null })\n      .style(\"fill\", function(_, i){ return(colors[i]) })\n      .style(\"font-weight\", \"bold\")\n      .style(\"font-size\", 12)\n      .text(function(d) { return preproc.REGION_NAME[d.index] })\n}\n\nfunction highlightGroup(eventData, links) {\n  links\n    .filter(function(d) { return d.source.index != eventData.index })\n    .attr(\"opacity\", 0.1)\n}\n\nfunction unhighlightGroup(links) {\n  links.attr(\"opacity\", 0.5)\n}\n\nexport function rebuild(div, data, startDate, endDate) {\n  div.select('#tab-3-chord-diagram')\n    .select('svg')\n    .remove()\n\n  build(div, data, startDate, endDate)\n}","import * as onglet1 from './scripts/onglet1.js'\nimport * as heatmap from './scripts/heatmap.js'\nimport * as chord from './scripts/chord.js'\n\nlet chordData\n\n(function (d3) {\n    d3.csv('./TRIP_STACK_HALF_MONTH.csv').then(function(stackData) {\n        onglet1.build(d3.select('#tab-1-content'), stackData)\n    \n        d3.csv('./TRIP_CHORD.csv').then(function(data) {\n            chordData = data\n            chord.build(d3.select('#tab-3-content'), data, \"2010-01-01\", \"2023-01-01\")\n    \n            time_graph(stackData)\n        })\n    \n        heatmap.buildHeatmap(d3.select('#tab-3-content'), \"2010-01-01\", \"2023-01-01\")\n    })\n\n})(d3)\n\n$('.tab-button').click(function () {\n    if (!$(this).hasClass('tab-button-active')) {\n        const tab = $(this).data('tab')\n\n        d3.select(\".visible-tips\").style(\"display\", \"none\")\n        d3.select(\".visible-tips\").classed(\"visible-tips\", false)\n        d3.select(`#tab-${tab}-tips`).style(\"display\", \"block\").classed(\"visible-tips\", true)\n    \n        $('button.tab-button').removeClass('tab-button-active')\n        $(this).addClass('tab-button-active')\n    \n        $('.tab-content').removeClass('visible-tab')\n        $(`.tab-content#tab-${tab}-content`).addClass('visible-tab')\n    }\n})\n\nfunction time_graph(stackData) {\n    const data = stackData.map(d => {\n        return { \n            date: d3.timeParse(\"%Y-%m-%d\")(d.date),\n            traffic: +d.Merchant\n            + +d.Barges\n            + +d.Other\n            + +d.Tugs\n            + +d.Tanker\n            + +d.Fishing\n            + +d.PleasureCrafts\n            + +d.Excursion\n        }\n    })\n    const ndx = crossfilter(data)\n\n    const vesselTraffic = ndx.dimension(d => d3.timeMonth(d.date))\n    const vesselTraffics = vesselTraffic.group().reduceSum(d => d.traffic)\n    \n    const minDate = vesselTraffic.bottom(1)[0].date\n    const maxDate = vesselTraffic.top(1)[0].date\n\n    const timeScale = d3.scaleTime()\n    .domain([minDate, maxDate])\n    .rangeRound([0, 950])\n\n    const vesselTrafficChart = new dc.BarChart('#tab-3-content .traffic-chart')\n    .width(950)\n    .height(125)\n    .margins({top: 10, right: 50, bottom: 30, left: 30})\n    .dimension(vesselTraffic)\n    .group(vesselTraffics)\n    .round(d3.timeMonth)\n    .x(timeScale)\n    .brushOn(true)\n    .elasticY(true)\n\n    vesselTrafficChart.yAxis().ticks(5)\n\n    vesselTrafficChart.render()\n\n    vesselTrafficChart.on('preRedraw', () => {\n        const selection = d3.select('#tab-3-content .traffic-chart g.brush rect.selection')\n        const x = selection.attr('x')\n        const width = selection.attr('width')\n        let startString\n        let endString\n        if (x == null || width == null) {\n            startString = minDate.toISOString().split('T')[0]\n            endString = maxDate.toISOString().split('T')[0]\n        } else {\n            const start = timeScale.invert(x)\n            const end = timeScale.invert(+x + +width)\n            startString = start.toISOString().split('T')[0]\n            endString = end.toISOString().split('T')[0]\n        }\n        chord.rebuild(d3.select('#tab-3-content'), chordData, startString, endString)\n        heatmap.rebuild(d3.select('#tab-3-content'), startString, endString)\n    })\n}"]}
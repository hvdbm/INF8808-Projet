{"version":3,"sources":["scripts/vesselTypeClasses.js","scripts/onglet1.js","scripts/onglet2.js","scripts/preprocess.js","scripts/onglet3.js","scripts/chord.js","index.js"],"names":["vesselTypeClasses","build","div","bounds","d3","select","node","getBoundingClientRect","margin","top","right","bottom","left","width","height","svg","append","attr","csv","d","date","timeParse","Other","Tugs","Fishing","Barges","Tanker","PleasureCrafts","Excursion","Merchant","then","data","keys","columns","slice","color","scaleOrdinal","domain","range","schemeSet2","stackedData","stack","x","scaleTime","extent","call","axisBottom","ticks","text","y","scaleLinear","axisLeft","areaChart","area","y0","y1","selectAll","enter","key","style","highlight","noHighlight","size","_","i","on","ROW_CHART_HEIGHT","ROW_CHART_HEIGHT_MARGIN","data1","data2","data3","dataTypes","concat","dataVesselTypes","Map","dataVesselTypesArray","map","vesselClass","Class","vesselType","Type","entry","set","get","index","departureDate","departurePort","arrivalDate","arrivalPort","vesselLength","vesselWidth","vesselCapacity","vesselDraught","chartWidth","chartHeight","chartNbBars","timeSelectWidth","ndx","crossfilter","vesselLengthRange","vesselLengthBarWidth","dimension","vesselLengths","group","Math","floor","vesselLengthChart","dc","BarChart","margins","xUnits","brushOn","xAxisLabel","elasticY","yAxis","render","vesselWidthRange","vesselWidthBarWidth","vesselWidths","vesselWidthChart","vesselCapacityRange","vesselCapacityBarWidth","vesselCapacities","vesselCapacityChart","vesselDraughtRange","vesselDraughtBarWidth","vesselDraughts","vesselDraughtChart","vesselTypes","typeColorScale","vesselTypeChart","PieChart","cy","innerRadius","colors","minAngleForLabel","legend","filter","vesselTraffic","vesselTraffics","timeMonth","minDate","maxDate","vesselTrafficRange","vesselTrafficBarWidth","vesselTrafficChart","round","rangeRound","portDim","includes","portTraffic","reduceCount","filteredGroup","remove_empty_bins","portChart","RowChart","value","xAxis","axisTop","othersGrouper","elasticX","label","fixedBarHeight","effectiveHeight","count","all","length","source_group","GLOBAL_VESSEL_TYPE","REGION_NAME","REGION_COLOR","REGION_NAME_ALT","findGlobalVesselType","clean","cleanData","forEach","element","push","substring","chordMatrix","matrix","Array","departureRegion","arrivalRegion","j","reduce","partialSum","v","Number","rebuild","startDate","endDate","remove","buildHeatmap","myGroups","preproc","myVars","scaleBand","padding","myColor","transformData","heatmapMap","line","keyStart","keyStop","has","current","p","max","from","values","Region","transformedData","rectSelect","rectUnselect","bandwidth","initLegend","drawLegend","region","type","toFixed","colorScale","defs","linearGradient","tick","nodes","offset","join","fill","scale","axis","axisRight","chordWidth","window","innerWidth","outerRadius","res","chord","padAngle","sortSubgroups","descending","links","datum","source","target","tooltip","subindex","ribbon","radius","tooltips","groups","arc","event","console","log","highlightGroup","unhighlightGroup","startAngle","PI","onglet1","onglet2","chordData","onglet3","start","property","end","$","click","hasClass","tab","removeClass","addClass"],"mappings":"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","file":"INF8808-Projet3.d320316c.js","sourceRoot":"..","sourcesContent":["export function vesselTypeClasses() {\r\n    return [\r\n        \"Barges\",\r\n        \"Excursion\",\r\n        \"Fishing\",\r\n        \"Merchant\",\r\n        \"Other\",\r\n        \"PleasureCrafts\",\r\n        \"Tanker\",\r\n        \"Tugs\",\r\n        \"Other\"\r\n    ]\r\n}","import { vesselTypeClasses } from './vesselTypeClasses.js'\r\n\r\n// Source : https://d3-graph-gallery.com/graph/stackedarea_template.html\r\nexport function build(div) {\r\n  // set the dimensions and margins of the graph\r\n  const bounds = d3.select('#stacked-area-chart').node().getBoundingClientRect()\r\n  var margin = {top: 60, right: 230, bottom: 50, left: 70},\r\n  width = bounds.width - margin.left - margin.right,\r\n  height = 550 - margin.top - margin.bottom;\r\n\r\n  // append the svg object to the body of the page\r\n  var svg = div.select(\"#stacked-area-chart\")\r\n  .append(\"svg\")\r\n    .attr(\"width\", width + margin.left + margin.right)\r\n    .attr(\"height\", height + margin.top + margin.bottom)\r\n  .append(\"g\")\r\n    .attr(\"transform\",\r\n          \"translate(\" + margin.left + \",\" + margin.top + \")\");\r\n\r\n  d3.csv('./TRIP_STACK_HALF_MONTH.csv', function(d){\r\n      return { \r\n        date : d3.timeParse(\"%Y-%m-%d\")(d.date),\r\n        Other : d.Other,\r\n        Tugs : d.Tugs,\r\n        Fishing : d.Fishing,\r\n        Barges : d.Barges,\r\n        Tanker : d.Tanker,\r\n        PleasureCrafts: d.PleasureCrafts,\r\n        Excursion : d.Excursion,\r\n        Merchant : d.Merchant,\r\n      }\r\n  }).then( function(data) {\r\n    const keys = data.columns.slice(1)  // List of Vessel Types = header of the csv files\r\n\r\n    const color = d3.scaleOrdinal()\r\n      .domain(vesselTypeClasses())\r\n      .range(d3.schemeSet2);\r\n\r\n    const stackedData = d3.stack()\r\n      .keys(keys)\r\n    (data)\r\n\r\n    // Add X axis\r\n    const x = d3.scaleTime()\r\n    .domain(d3.extent(data, d => d.date))\r\n    .range([ 0, width ]);\r\n    svg.append(\"g\")\r\n      .attr(\"transform\", \"translate(0,\" + height + \")\")\r\n      .call(d3.axisBottom(x).ticks(10))\r\n\r\n    // Add X axis label:\r\n    svg.append(\"text\")\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"x\", width)\r\n      .attr(\"y\", height+40 )\r\n      .text(\"Temps\");\r\n\r\n    // Add Y axis\r\n    const y = d3.scaleLinear()\r\n      .domain([0, 12000])     // TODO : Y Automatique ?\r\n      .range([ height, 0 ]);\r\n    svg.append(\"g\")\r\n      .call(d3.axisLeft(y).ticks(15))\r\n\r\n    // Add Y axis label:\r\n    svg.append(\"text\")\r\n      .attr(\"text-anchor\", \"end\")\r\n      .attr(\"x\", 0)\r\n      .attr(\"y\", -20 )\r\n      .text(\"Nombre de navires\")\r\n      .attr(\"text-anchor\", \"start\")\r\n\r\n    // Area generator\r\n    const areaChart = svg.append('g')\r\n    const area = d3.area()\r\n      .x(function(d) { return x(d.data.date); })\r\n      .y0(function(d) { return y(d[0]); })\r\n      .y1(function(d) { return y(d[1]); })\r\n\r\n    // Show the areas\r\n    areaChart\r\n    .selectAll(\"mylayers\")\r\n    .data(stackedData)\r\n    .enter()\r\n    .append(\"path\")\r\n      .attr(\"class\", function(d) { return \"myArea \" + d.key })\r\n      .style(\"fill\", function(d) { return color(d.key); })\r\n      .attr(\"d\", area)\r\n\r\n    // What to do when one group is hovered\r\n    const highlight = function(d) {\r\n      d3.selectAll(\".myArea\").style(\"opacity\", .1)  // reduce opacity of all groups\r\n      d3.select(\".\"+d).style(\"opacity\", 1)  // expect the one that is hovered\r\n    }\r\n\r\n    // And when it is not hovered anymore\r\n    const noHighlight = function(){\r\n      d3.selectAll(\".myArea\").style(\"opacity\", 1)\r\n    }\r\n\r\n    // LEGEND //\r\n    const size = 20\r\n    svg.selectAll(\"myrect\")   // Add one dot in the legend for each name.\r\n      .data(keys)\r\n      .enter()\r\n      .append(\"rect\")\r\n        .attr(\"x\", width)\r\n        .attr(\"y\", function(_,i){ return 10 + i*(size+5)}) // 100 is where the first dot appears. 25 is the distance between dots\r\n        .attr(\"width\", size)\r\n        .attr(\"height\", size)\r\n        .attr(\"stroke-width\", 0.5)\r\n        .attr(\"stroke\", \"black\")\r\n        .style(\"fill\", function(d){ return color(d)})\r\n        .on(\"mouseover\", highlight)\r\n        .on(\"mouseleave\", noHighlight)\r\n\r\n    svg.selectAll(\"mylabels\")   // Add one dot in the legend for each name.\r\n      .data(keys)\r\n      .enter()\r\n      .append(\"text\")\r\n        .attr(\"x\", width + size*1.2)\r\n        .attr(\"y\", function(_,i){ return 10 + i*(size+5) + (size/2)}) // 100 is where the first dot appears. 25 is the distance between dots\r\n        .style(\"fill\", function(d){ return color(d)})\r\n        .text(function(d){ return d})\r\n        .attr(\"text-anchor\", \"left\")\r\n        .style(\"alignment-baseline\", \"middle\")\r\n        // .attr(\"stroke-width\", 0.2)\r\n        // .attr(\"stroke\", \"black\")\r\n        .on(\"mouseover\", highlight)\r\n        .on(\"mouseleave\", noHighlight)\r\n    })\r\n}\r\n","import { vesselTypeClasses } from './vesselTypeClasses.js'\r\n\r\nexport function build() {\r\n    \r\n    const ROW_CHART_HEIGHT = 16.68\r\n    const ROW_CHART_HEIGHT_MARGIN = 21.75\r\n\r\n    // Reading the data\r\n    d3.csv(\"./TRIP_Part1.csv\").then( function(data1) {\r\n        d3.csv(\"./TRIP_Part2.csv\").then( function(data2) {\r\n            d3.csv(\"./TRIP_Part3.csv\").then( function(data3) {\r\n                d3.csv(\"./Vessel Type Class.csv\").then(function(dataTypes) {\r\n                    // Id,Departure Date,Departure Hardour,Departure Region,Departure Latitude,Departure Longitude,Arrival Date,Arrival Hardour,Arrival Region,Arrival Latitude,Arrival Longitude,Vessel Type,Lenght,Width,DeadWeight Tonnage,Maximum Draugth\r\n                    // 6079000000783579,    2011-01-01 00:00:00.000,Virtual Harbour (Central Region),Central Region,45.71666667,-84.24861111,2011-01-01 15:30:00.000,Goderich,Central Region,43.745,-81.7294441666667,Merchant Bulk,222.509994506836,22.9400005340576,31751,8.72999954223633\r\n                    // 23079000000766048,   2011-01-01 00:10:00.000,Whiffen Head,Newfoundland Region,47.7727836111111,-54.0171797222222,2011-01-01 01:00:00.000,Whiffen Head,Newfoundland Region,47.7727836111111,-54.0171797222222,Tug Fire,38.9000015258789,13.8999996185303,314,3.5\r\n                    // 23079000000766035,   2011-01-01 00:57:00.000,Whiffen Head,Newfoundland Region,47.7727836111111,-54.0171797222222,2011-01-02 12:45:00.000,Virtual Harbour (Newfoundland Region),Newfoundland Region,47.75,-53,Merchant Crude,271.799987792969,46.0499992370606,126646,15.3459997177124\r\n        \r\n                    let data = data1.concat(data2).concat(data3)\r\n                    let dataVesselTypes = new Map()\r\n    \r\n                    const dataVesselTypesArray = dataTypes.map((d) => {\r\n                        return {\r\n                            vesselClass: d.Class,\r\n                            vesselType: d.Type\r\n                        }\r\n                    })\r\n    \r\n                    for (const entry of dataVesselTypesArray) {\r\n                        const vesselClass = entry.vesselClass\r\n                        const vesselType = entry.vesselType\r\n                        dataVesselTypes.set(vesselType, vesselClass)\r\n                    }\r\n                    \r\n                    data = data.map((d, i) => {\r\n                        const vesselType = d['Vessel Type']\r\n                        let vesselClass = dataVesselTypes.get(d['Vessel Type'])\r\n                        if (vesselType == '<Unknown Type>') {\r\n                            vesselClass = 'Other'\r\n                        }\r\n                        return {\r\n                            index: i,\r\n                            departureDate: d3.timeParse('%Y-%m-%d')(d['Departure Date']),\r\n                            departurePort: d['Departure Hardour'],\r\n                            arrivalDate: d3.timeParse('%Y-%m-%d')(d['Arrival Date']),\r\n                            arrivalPort: d['Arrival Hardour'],\r\n                            vesselClass: vesselClass,\r\n                            vesselType: d['Vessel Type'],\r\n                            vesselLength: +d['Lenght'],\r\n                            vesselWidth: +d['Width'],\r\n                            vesselCapacity: +d['DeadWeight Tonnage'],\r\n                            vesselDraught: +d['Maximum Draugth']\r\n                        }\r\n                    })\r\n\r\n                    const chartWidth = 776\r\n                    const chartHeight = 160\r\n                    const chartNbBars = 50\r\n\r\n                    const timeSelectWidth = 950\r\n\r\n                    const ndx = crossfilter(data)\r\n\r\n                    const vesselLengthRange = 400\r\n                    const vesselLengthBarWidth = vesselLengthRange / chartNbBars\r\n                    const vesselLength = ndx.dimension(d => d.vesselLength)\r\n                    const vesselLengths = vesselLength.group(d => Math.floor(d / vesselLengthBarWidth) * vesselLengthBarWidth)\r\n\r\n                    const vesselLengthChart = new dc.BarChart('#length-chart')\r\n                    .width(chartWidth)\r\n                    .height(chartHeight)\r\n                    .margins({top: 10, right: 50, bottom: 30, left: 50})\r\n                    .x(d3.scaleLinear()\r\n                        .domain([0, vesselLengthRange]))\r\n                    .xUnits(() => chartNbBars)\r\n                    .brushOn(false)\r\n                    .xAxisLabel(\"Longueur\")\r\n                    .elasticY(true)\r\n                    .dimension(vesselLength)\r\n                    .group(vesselLengths)\r\n                    \r\n                    vesselLengthChart.yAxis().ticks(8)\r\n\r\n                    vesselLengthChart.render()\r\n\r\n                    const vesselWidthRange = 180\r\n                    const vesselWidthBarWidth = vesselWidthRange / chartNbBars\r\n                    const vesselWidth = ndx.dimension(d => d.vesselWidth)\r\n                    const vesselWidths = vesselWidth.group(d => Math.floor(d / vesselWidthBarWidth) * vesselWidthBarWidth)\r\n\r\n                    const vesselWidthChart = new dc.BarChart('#width-chart')\r\n                    .width(chartWidth)\r\n                    .height(chartHeight)\r\n                    .margins({top: 10, right: 50, bottom: 30, left: 50})\r\n                    .x(d3.scaleLinear()\r\n                        .domain([0, vesselWidthRange]))\r\n                    .xUnits(() => chartNbBars)\r\n                    .brushOn(false)\r\n                    .xAxisLabel(\"Largeur\")\r\n                    .elasticY(true)\r\n                    .dimension(vesselWidth)\r\n                    .group(vesselWidths)\r\n\r\n                    vesselWidthChart.yAxis().ticks(7)\r\n\r\n                    vesselWidthChart.render()\r\n\r\n                    const vesselCapacityRange = 650000\r\n                    const vesselCapacityBarWidth = vesselCapacityRange / chartNbBars\r\n                    const vesselCapacity = ndx.dimension(d => d.vesselCapacity)\r\n                    const vesselCapacities = vesselCapacity.group(d => Math.floor(d / vesselCapacityBarWidth) * vesselCapacityBarWidth)\r\n\r\n                    const vesselCapacityChart = new dc.BarChart('#capacity-chart')\r\n                    .width(chartWidth)\r\n                    .height(chartHeight)\r\n                    .margins({top: 10, right: 50, bottom: 30, left: 50})\r\n                    .x(d3.scaleLinear()\r\n                        .domain([0, vesselCapacityRange]))\r\n                    .xUnits(() => chartNbBars)\r\n                    .brushOn(false)\r\n                    .xAxisLabel(\"Capacité\")\r\n                    .elasticY(true)\r\n                    .dimension(vesselCapacity)\r\n                    .group(vesselCapacities)\r\n                    \r\n                    vesselCapacityChart.yAxis().ticks(9)\r\n\r\n                    vesselCapacityChart.render()\r\n\r\n                    const vesselDraughtRange = 30\r\n                    const vesselDraughtBarWidth = vesselDraughtRange / chartNbBars\r\n                    const vesselDraught = ndx.dimension(d => d.vesselDraught)\r\n                    const vesselDraughts = vesselDraught.group(d => Math.floor(d / vesselDraughtBarWidth) * vesselDraughtBarWidth)\r\n\r\n                    const vesselDraughtChart = new dc.BarChart('#draught-chart')\r\n                    .width(chartWidth)\r\n                    .height(chartHeight)\r\n                    .margins({top: 10, right: 50, bottom: 30, left: 50})\r\n                    .x(d3.scaleLinear()\r\n                        .domain([0, vesselDraughtRange]))\r\n                    .xUnits(() => chartNbBars)\r\n                    .brushOn(false)\r\n                    .xAxisLabel(\"Tirant d'eau\")\r\n                    .elasticY(true)\r\n                    .dimension(vesselDraught)\r\n                    .group(vesselDraughts)\r\n                    \r\n                    vesselDraughtChart.yAxis().ticks(6)\r\n\r\n                    vesselDraughtChart.render()\r\n\r\n                    const vesselType = ndx.dimension(d => d.vesselClass)\r\n                    const vesselTypes = vesselType.group()\r\n\r\n                    const typeColorScale = d3.scaleOrdinal(d3.schemeSet2).domain(vesselTypeClasses())\r\n\r\n                    const vesselTypeChart = new dc.PieChart(\"#type-chart\")\r\n                    .width(150)\r\n                    .height(310)\r\n                    .cy(75)\r\n                    .innerRadius(50)\r\n                    .dimension(vesselTypes)\r\n                    .group(vesselTypes)\r\n                    .colors(typeColorScale)\r\n                    .minAngleForLabel(360)\r\n                    .legend(dc.legend().y(160))\r\n\r\n                    vesselTypeChart.filter = function() {};\r\n\r\n                    vesselTypeChart.render()\r\n\r\n                    const vesselTraffic = ndx.dimension(d => d.departureDate)\r\n                    const vesselTraffics = vesselTraffic.group(d3.timeMonth)\r\n                    \r\n                    const minDate = vesselTraffic.bottom(1)[0].departureDate\r\n                    const maxDate = vesselTraffic.top(1)[0].departureDate\r\n\r\n                    const vesselTrafficRange = maxDate - minDate\r\n                    const vesselTrafficBarWidth = vesselTrafficRange / chartNbBars\r\n\r\n                    const vesselTrafficChart = new dc.BarChart('#traffic-chart')\r\n                    .width(timeSelectWidth)\r\n                    .height(125)\r\n                    .margins({top: 10, right: 50, bottom: 30, left: 50})\r\n                    .dimension(vesselTraffic)\r\n                    .group(vesselTraffics)\r\n                    .round(d3.timeMonth)\r\n                    .x(d3.scaleTime()\r\n                        .domain([minDate, maxDate])\r\n                        .rangeRound([0, timeSelectWidth]))\r\n                    .brushOn(true)\r\n                    .elasticY(true)\r\n\r\n                    vesselTrafficChart.yAxis().ticks(5)\r\n\r\n                    vesselTrafficChart.render()\r\n\r\n                    const portDim = ndx.dimension(d => d.departurePort)\r\n\r\n                    ndx.dimension(d=> d.departurePort)\r\n                    .filter(d => !d.includes('Virtual Harbour'))\r\n\r\n                    const portTraffic = portDim.group().reduceCount()\r\n                    const filteredGroup = remove_empty_bins(portTraffic)\r\n\r\n                    const portChart = new dc.RowChart('#port-chart')\r\n                    .width(600)\r\n                    .height(900)\r\n                    .margins({top: 30, right: 50, bottom: 30, left: 30})\r\n                    .dimension(portDim)\r\n                    .group(filteredGroup)\r\n                    .x(d3.scaleLinear()\r\n                        .domain([0, portTraffic.top(1)[0].value])\r\n                        .rangeRound([0, 500]))\r\n                    .xAxis(d3.axisTop())\r\n                    .colors(d3.scaleOrdinal(['#1f77b4']))\r\n                    .othersGrouper(false)\r\n                    .elasticX(true)\r\n                    .label(d => d.key + ': ' + d.value)\r\n                    .fixedBarHeight(ROW_CHART_HEIGHT)\r\n\r\n                    portChart.on('pretransition', function() {\r\n                        portChart.select('g.axis').attr('transform', 'translate(0,0)')\r\n                        portChart.selectAll('line.grid-line').attr('y2', portChart.effectiveHeight())\r\n                        const count = filteredGroup.all().length\r\n                        const height = count * ROW_CHART_HEIGHT_MARGIN + 20\r\n                        portChart.select('svg').attr('height', height)\r\n                    })\r\n\r\n                    portChart.render()\r\n                })\r\n            })\r\n        })\r\n    })\r\n}\r\n\r\n// https://github.com/dc-js/dc.js/wiki/FAQ#how-do-i-filter-the-data-before-its-charted\r\nfunction remove_empty_bins(source_group) {\r\n    return {\r\n        all:function () {\r\n            return source_group.all().filter(function(d) {\r\n                return d.value !== 0;\r\n            });\r\n        }\r\n    };\r\n}","export const GLOBAL_VESSEL_TYPE = ['Barges', 'Excursion', 'Fishing', 'Merchant', 'Other', 'Pleasure Crafts', 'Tanker', 'Tugs']\r\nexport const REGION_NAME = ['Arctic', 'Central', 'East Canadian Water', 'Newfoundland', 'Maritimes', 'Pacific', 'Quebec', 'St. Lawrence Seaway', 'West Canadian Water']\r\nexport const REGION_COLOR = ['#CAB2D6', '#6A3D9A', '#33A02C', '#FB9A99', '#FDBF6F', '#E31A1C', '#1F78B4', '#A6CEE3', '#FF7F00']\r\nexport const REGION_NAME_ALT = ['Arctic', 'Central', 'East_Canadian_Water', 'Newfoundland', 'Maritimes', 'Pacific', 'Quebec', 'St_Lawrence_Seaway', 'West_Canadian_Water']\r\n\r\nfunction findGlobalVesselType(vesselType) {\r\n  if (['Barge Bulk Cargo', 'Barge Chemical','Barge Chips','Barge Derrick','Barge General','Barge Log','Barge Miscellaneous','Barge Oil Drilling Rig', 'Barge Oil/Petroleum', 'Barge Rail/Trailer','Barge Self-Propelled','Barge Towed',\"Don't use\",'Landing Craft','Logs Raft Section'].includes(vesselType)) {\r\n    return 'Barges'\r\n  } else if (['Excursion Passenger'].includes(vesselType)) {\r\n    return 'Excursion'\r\n  } else if (['Crab Boat', 'Dragger (Scallop, Clam, etc.)', 'Factory Ship', 'Fishery Patrol', 'Fishing Vessel', 'Gillnetter', 'Groundfish Boat (Open Boat)', 'Lobster Boat', 'Longliner', 'Other Fishing VSL (Open Boat)', 'Seiner', 'Shrimp Boat', 'Trawler', 'Troller'].includes(vesselType)) {\r\n    return 'Fishing'\r\n  } else if (['Cruise', 'Merchant (Dry)', 'Merchant Auto', 'Merchant Bulk', 'Merchant Cement', 'Merchant Coastal', 'Merchant Container', 'Merchant Ferry', 'Merchant General', 'Merchant Lash', 'Merchant Livestock', 'Merchant Ore', 'Merchant Passenger', 'Merchant Rail/Trailer Ferry', 'Merchant Reefer', 'Merchant RO/RO'].includes(vesselType)) {\r\n    return 'Merchant'\r\n  } else if (['Yacht - Pleasure Crafts', 'Yacht Power', 'Yacht Sails'].includes(vesselType)) {\r\n    return 'Pleasure Crafts'\r\n  } else if(['Merchant (Tanker)', 'Merchant Chemical', 'Merchant Chemical/Oil Products Tanker','Merchant Crude','Merchant Gasoline','Merchant Liquified Gas','Merchant Molasses','Merchant Ore/Bulk/Oil','Merchant Super Tanker','Merchant ULCC','Merchant VLCC','Merchant Water'].includes(vesselType)) {\r\n    return 'Tanker'\r\n  } else if (['Tug', 'Tug Fire', 'Tug Harbour', 'Tug Ocean', 'Tug Supply', 'Tugs Workboat'].includes(vesselType)) {\r\n    return 'Tugs'\r\n  } else {\r\n    return 'Other'\r\n  }\r\n}\r\n\r\nexport function clean(data) {\r\n  const cleanData = []\r\n  data.forEach(element => {\r\n    if (element['Lenght'] != 0 && \r\n        element['Width'] != 0 & \r\n        element['Maximum Draugth'] < 30 &&\r\n        element['Departure Date'] < ['Arrival Date']) {\r\n      cleanData.push({\r\n        'Arrival Date': element['Arrival Date'].substring(0,10),\r\n        'Arrival Hardour': element['Arrival Hardour'],\r\n        'Arrival Region': element['Arrival Region'],\r\n        'DeadWeight Tonnage': element['DeadWeight Tonnage'],\r\n        'Departure Date': element['Departure Date'].substring(0, 10),\r\n        'Departure Hardour': element['Departure Hardour'],\r\n        'Departure Region': element['Departure Region'],\r\n        'Lenght': element['Lenght'],\r\n        'Maximum Draugth': element['Maximum Draugth'],\r\n        'Vessel Type': element['Vessel Type'],\r\n        'Global Vessel Type': findGlobalVesselType(element['Vessel Type']),\r\n        'Width': element['Width']\r\n      })\r\n    }\r\n  })\r\n\r\n  return cleanData\r\n}\r\n\r\nexport function chordMatrix(data, departureDate, arrivalDate) {\r\n  const matrix = new Array(REGION_NAME.length)\r\n  for (let index = 0; index < matrix.length; index++) {\r\n    matrix[index] = new Array(REGION_NAME.length)\r\n  }\r\n  \r\n  REGION_NAME.forEach((departureRegion, i) => {\r\n    REGION_NAME.forEach((arrivalRegion, j) => {\r\n      matrix[i][j] = data\r\n        .filter((d) => {\r\n          return departureRegion === d['Departure Region'].slice(0,-7)\r\n            && arrivalRegion === d['Arrival Region'].slice(0,-7)\r\n            && departureDate <= d['Departure Date']\r\n            && arrivalDate >= d['Arrival Date']\r\n        })\r\n        .map((value) => value.count)\r\n        .reduce((partialSum, v) => Number(partialSum) + Number(v), 0)\r\n    })\r\n  })\r\n\r\n  return matrix\r\n}","import * as preproc from './preprocess.js'\r\n\r\nexport function rebuild(div, startDate, endDate) {\r\n  div.select(\"#tab-3-heatmap\")\r\n    .select('svg')\r\n    .remove()\r\n\r\n  buildHeatmap(div, startDate, endDate)\r\n}\r\n\r\n// https://d3-graph-gallery.com/heatmap.html\r\nexport function buildHeatmap(div, startDate, endDate) {\r\n  // TODO : adapt to div size\r\n\r\n  // set the dimensions and margins of the graph\r\n  const margin = {top: 10, right: 5, bottom: 90, left: 115},\r\n    width = 450 - margin.left - margin.right,\r\n    height = 450 - margin.top - margin.bottom;\r\n\r\n  // append the svg object to the body of the page\r\n  const svg = div.select(\"#tab-3-heatmap\")\r\n  .append(\"svg\")\r\n    .attr(\"width\", width + margin.left + margin.right + 50)\r\n    .attr(\"height\", height + margin.top + margin.bottom)\r\n  .append(\"g\")\r\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n\r\n  // Labels of row and columns\r\n  const myGroups = preproc.GLOBAL_VESSEL_TYPE\r\n  const myVars = preproc.REGION_NAME\r\n\r\n  // Build X scales and axis:\r\n  const x = d3.scaleBand()\r\n    .range([ 0, width ])\r\n    .domain(myGroups)\r\n    .padding(0.01)\r\n\r\n  svg.append(\"g\")\r\n    .attr(\"transform\", `translate(0, ${height})`)\r\n    .call(d3.axisBottom(x))\r\n    .selectAll('text')\r\n    .attr('transform', 'translate(-20,20)rotate(-45)')\r\n\r\n  // Build Y scales and axis:\r\n  const y = d3.scaleBand()\r\n    .range([ height, 0 ])\r\n    .domain(myVars)\r\n    .padding(0.01)\r\n  svg.append(\"g\")\r\n    .call(d3.axisLeft(y))\r\n\r\n  // Build color scale\r\n  const myColor = d3.scaleLinear()\r\n    .range([\"white\", \"#ff0000\"])\r\n\r\n\r\n  function transformData(d, departureDate, arrivalDate) {\r\n    let map = heatmapMap()\r\n\r\n    const data = d.filter((line) => {\r\n      return departureDate <= line['Departure Date'] && arrivalDate >= line['Arrival Date']\r\n    })\r\n\r\n    data.forEach(line => {\r\n      const keyStart = line['Departure Region']+line['Global Vessel Type'];\r\n      const keyStop = line['Arrival Region']+line['Global Vessel Type'];\r\n      if (!map.has(keyStart)) {\r\n        map.set(keyStart, {\r\n          'Region': line['Departure Region'].slice(0,-7),\r\n          'Type': line['Global Vessel Type'],\r\n          'count': 1\r\n          });\r\n      } else {\r\n        const current = map.get(keyStart);\r\n        current.count += 1;\r\n        map.set(keyStart, current);\r\n      }\r\n      if (!map.has(keyStop)) {\r\n        map.set(keyStop, {\r\n          'Region': line['Arrival Region'].slice(0,-7),\r\n          'Type': line['Global Vessel Type'],\r\n          'count': 1\r\n          });\r\n      } else {\r\n        const current = map.get(keyStop);\r\n        current.count += 1;\r\n        map.set(keyStop, current);\r\n      }\r\n    })\r\n\r\n    const p = [];\r\n    let max = 0\r\n    Array.from(map.values()).forEach((value) => {\r\n      p.push({\r\n        'Region': value.Region,\r\n        'Type': value.Type,\r\n        'count' : (value.count / (2*data.length)) * 100\r\n      })\r\n      if ((value.count / (2*data.length)) * 100 >= max) {\r\n        max = (value.count / (2*data.length)) * 100\r\n      }\r\n    })\r\n    myColor.domain([0,max])\r\n\r\n    return p\r\n  }\r\n\r\n  //Read the data\r\n  d3.csv(\"./TRIP_HEATMAP.csv\").then( function(data) {\r\n    // add the squares and interaction\r\n    const transformedData = transformData(data, startDate, endDate)\r\n    svg.selectAll()\r\n    .data(transformedData, function(d) {\r\n      return d.Type+':'+d.Region;\r\n    })\r\n    .enter()\r\n    .append(\"g\")\r\n    .attr(\"class\", \"square\")\r\n    .on('mouseenter', function() { rectSelect(this, x, y) })\r\n    .on('mouseleave', function() { rectUnselect(this) })\r\n    .append(\"rect\")\r\n      .attr(\"x\", function(d) { return x(d.Type) })\r\n      .attr(\"y\", function(d) { return y(d.Region) })\r\n      .attr(\"width\", x.bandwidth() )\r\n      .attr(\"height\", y.bandwidth() )\r\n      .style(\"fill\", function(d) { return myColor(d.count) })\r\n    \r\n      initLegend(svg,myColor)\r\n      drawLegend(width + margin.right + 10, 0, height, 15, 'url(#gradient)', myColor)\r\n  })\r\n}\r\n\r\nfunction heatmapMap() {\r\n  let map = new Map();\r\n\r\n  preproc.REGION_NAME.forEach((region) => {\r\n    preproc.GLOBAL_VESSEL_TYPE.forEach((type) => {\r\n      const key = region + type\r\n      map.set(key, {\r\n        'Region': region,\r\n        'Type': type,\r\n        'count': 0\r\n      })\r\n    })\r\n  })\r\n  return map\r\n}\r\n\r\nfunction rectSelect(element, x, y) {\r\n  d3.select(element)\r\n    .append(\"text\")\r\n    .attr('x', function(d) { return x(d.Type) + x.bandwidth() / 2; })\r\n    .attr('y', function(d) { return y(d.Region) + y.bandwidth() / 2; })\r\n    .attr('text-anchor', 'middle')\r\n    .attr('dominant-baseline', 'middle')\r\n    .text(function(d) {\r\n      return d.count.toFixed(2) + '%'\r\n    })\r\n}\r\n\r\nfunction rectUnselect(element) {\r\n  d3.select(element)\r\n    .select('text')\r\n    .remove()\r\n}\r\n\r\nfunction initLegend(svg, colorScale) {\r\n  const defs = svg.append('defs')\r\n  svg.append('rect').attr('class', 'legend bar')\r\n  svg.append('g').attr('class', 'legend axis')\r\n\r\n  const linearGradient = defs\r\n  .append('linearGradient')\r\n  .attr('id', 'gradient')\r\n  .attr('x1', 0).attr('y1', 1).attr('x2', 0).attr('y2', 0)\r\n\r\n  linearGradient.selectAll('stop')\r\n  .data(colorScale.ticks().map((tick, i, nodes) => (\r\n    {\r\n      offset: `${ (100*i / nodes.length)}%`,\r\n      color: colorScale(tick)\r\n    })))\r\n  .join('stop')\r\n  .attr('offset', d => d.offset)\r\n  .attr('stop-color', d => d.color)\r\n}\r\n\r\nfunction drawLegend(x, y, height, width, fill, colorScale) {\r\n  d3.select('.legend.bar')\r\n    .attr('fill', fill)\r\n    .attr('x', x)\r\n    .attr('y', y)\r\n    .attr('height', height)\r\n    .attr('width', width)\r\n    \r\n  const scale = d3.scaleLinear()\r\n  .domain(colorScale.domain())\r\n  .range([height, 0])\r\n\r\n  let axis = d3.axisRight()\r\n  .ticks(7)\r\n  .scale(scale);\r\n\r\n  d3.select('.legend.axis')\r\n  .call(axis)\r\n  .attr('transform', 'translate('+ (x+15) + ',' + y + ')')\r\n}\r\n","import * as preproc from './preprocess.js'\r\n\r\n// https://d3-graph-gallery.com/chord.html\r\n// https://observablehq.com/@d3/directed-chord-diagram\r\n// https://jyu-theartofml.github.io/posts/circos_plot\r\n// http://strongriley.github.io/d3/ex/chord.html\r\nexport function build(div, data, startDate, endDate) {\r\n  // TODO : Comment trouver la taille d'une div encore non chargée ?\r\n\r\n  let chordWidth = window.innerWidth / 2 // screen.width/2;\r\n\r\n  var margin = {\r\n    top: chordWidth*0.17,\r\n    right: chordWidth*0.05, \r\n    bottom: chordWidth*0.07,\r\n    left: chordWidth*0.20 }, // TODO : Revoir valeur\r\n  width = chordWidth - margin.left - margin.right,\r\n  height = chordWidth - margin.top - margin.bottom;\r\n\r\n  //const innerRadius = chordWidth / 4 // TODO : Revoir valeur\r\n  //const outerRadius = innerRadius + 10\r\n  const outerRadius = width/3.5;\r\n  const innerRadius = outerRadius-10\r\n  // create the svg area\r\n  const svg = div.select('#tab-3-chord-diagram')\r\n  .append(\"svg\")\r\n    .attr(\"width\", width + margin.left + margin.right)\r\n    .attr(\"height\", height + margin.top + margin.bottom)\r\n  .append(\"g\")\r\n    .attr(\"transform\", \"translate(\" + (margin.left+outerRadius) + \",\" + (margin.top+outerRadius) + \")\");\r\n\r\n  // create input data: a square matrix that provides flow between entities\r\n  const matrix = preproc.chordMatrix(data, startDate, endDate)\r\n  \r\n  const colors = preproc.REGION_COLOR\r\n\r\n  // give this matrix to d3.chord(): it will calculates all the info we need to draw arc and ribbon\r\n  const res = d3.chord()\r\n    .padAngle(0.05)     // padding between entities (black arc)\r\n    .sortSubgroups(d3.descending)\r\n    (matrix)\r\n\r\n  // add the links between groups\r\n  const links = svg\r\n  .datum(res)\r\n  .append(\"g\")\r\n  .attr(\"id\", \"links\")\r\n  .selectAll(\"path\")\r\n  .data(function(d) { return d; })\r\n  .enter()\r\n  .append(\"path\")\r\n    .attr(\"class\", \"chord\")\r\n    .on('mouseenter', function({source, target}, _) {\r\n      const tooltip = d3.select(`#${preproc.REGION_NAME_ALT[source.index]}${preproc.REGION_NAME_ALT[source.subindex]}`)\r\n      return tooltip.style(\"visibility\", \"visible\");\r\n    })\r\n    .on('mouseleave', function({source, target}, _) {\r\n      const tooltip = d3.select(`#${preproc.REGION_NAME_ALT[source.index]}${preproc.REGION_NAME_ALT[source.subindex]}`)\r\n      return tooltip.style(\"visibility\", \"hidden\");\r\n    })\r\n    .attr(\"d\", d3.ribbon()\r\n      .radius(innerRadius)\r\n    )\r\n    .style(\"fill\", function(d){ return(colors[d.source.index]) }) // colors depend on the source group. Change to target otherwise.\r\n    .style(\"stroke\", \"black\")\r\n    .attr(\"opacity\", 0.5)\r\n\r\n  const tooltips = svg\r\n    .datum(res)\r\n    .append(\"g\")\r\n    .attr(\"id\",\"tooltip\")\r\n    .selectAll(\"path\")\r\n    .data(function(d) { return d; })\r\n    .enter()\r\n    .append(\"text\")\r\n      .attr(\"id\",function(d) {\r\n        return (`${preproc.REGION_NAME_ALT[d.source.index]}${preproc.REGION_NAME_ALT[d.source.subindex]}`);})\r\n      .attr(\"class\", \"tooltip\")\r\n      .attr(\"x\",0)\r\n      .attr(\"y\",outerRadius+25)\r\n      .attr('text-anchor', 'middle')\r\n      .attr('dominant-baseline', 'middle')\r\n      .text(function(d) {\r\n        return `${preproc.REGION_NAME[d.source.index]} --> ${preproc.REGION_NAME[d.source.subindex]} : ${d.source.value} navires`\r\n      })\r\n      .style(\"visibility\", \"hidden\")\r\n\r\n  // add the groups on the outer part of the circle\r\n  svg.datum(res)\r\n    .append(\"g\")\r\n    .attr(\"id\", \"groups\")\r\n    .selectAll(\"g\")\r\n    .data(function(d) { return d.groups; })\r\n    .enter()\r\n    .append(\"g\")\r\n    .attr(\"class\", \"group\")\r\n    .append(\"path\")\r\n      .style(\"fill\", function(_,i){ return colors[i] })\r\n      .style(\"stroke\", \"black\")\r\n      .attr(\"d\", d3.arc()\r\n        .innerRadius(innerRadius)\r\n        .outerRadius(outerRadius)\r\n      )\r\n      .on(\"mouseover\", function(event, _) {\r\n        console.log(`Région ${preproc.REGION_NAME[event.index]} (${event.value} navires)`)\r\n        highlightGroup(event, links)\r\n      })\r\n      .on(\"mouseleave\", function() {\r\n        unhighlightGroup(links)\r\n      })\r\n\r\n  // add the label of groups\r\n  svg.datum(res)\r\n    .append(\"g\")\r\n    .attr(\"id\", \"labels\")\r\n    .selectAll(\"text\")\r\n    .data(function(d) { return d.groups; })\r\n    .enter()\r\n    .append(\"g\")\r\n    .attr(\"transform\", function(d) { return \"rotate(\" + (d.startAngle * 180 / Math.PI - 90) + \") translate(\" + outerRadius + \",0)\"; })  // TODO : Revoir valeur\r\n    .append(\"text\")\r\n    .attr(\"x\", 8)\r\n    .attr(\"dy\", \".25em\")\r\n    .attr(\"transform\", function(d) { return d.startAngle > Math.PI ? \"rotate(180) translate(-16)\" : null; })\r\n    .style(\"text-anchor\", function(d) { return d.startAngle > Math.PI ? \"end\" : null; })\r\n    .style(\"fill\", function(_, i){ return(colors[i]) })\r\n    .style(\"font-weight\", \"bold\")\r\n    .style(\"font-size\",12)\r\n    .text(function(d) {\r\n      return preproc.REGION_NAME[d.index]\r\n      // if (d.index != 7 && d.index != 8) {\r\n      //   return preproc.REGION_NAME[d.index]\r\n      // } else if (d.index == 7) {\r\n      //   console.log(preproc.REGION_NAME[d.index])\r\n      //   return preproc.REGION_NAME[d.index].slice(0, 12) + \"tspan\" + preproc.REGION_NAME[d.index].slice(12,)\r\n      // } else {\r\n      //   console.log(preproc.REGION_NAME[d.index])\r\n      //   return preproc.REGION_NAME[d.index].slice(0, 13) \r\n      // }\r\n    })\r\n}\r\n\r\nfunction highlightGroup(event, links) {\r\n  links\r\n    .filter(function(d) { return d.source.index != event.index })\r\n    .attr(\"opacity\", 0.1)\r\n}\r\n\r\nfunction unhighlightGroup(links) {\r\n  links.attr(\"opacity\", 0.5)\r\n}\r\n\r\nexport function rebuild(div, data, startDate, endDate) {\r\n  div.select('#tab-3-chord-diagram')\r\n    .select('svg')\r\n    .remove()\r\n\r\n  build(div, data, startDate, endDate)\r\n}","import * as onglet1 from './scripts/onglet1.js'\r\nimport * as onglet2 from './scripts/onglet2.js'\r\nimport * as onglet3 from './scripts/onglet3.js'\r\nimport * as chord from './scripts/chord.js'\r\n\r\n(function (d3) {\r\n    onglet1.build(d3.select('#tab-1-content'))\r\n\r\n    onglet2.build()\r\n\r\n    let chordData;\r\n    d3.csv('./TRIP_CHORD.csv').then(function(data) {\r\n        chordData = data\r\n        chord.build(d3.select('#tab-3-content'), data, \"2010-01-01\", \"2023-01-01\")\r\n    })\r\n\r\n    onglet3.buildHeatmap(d3.select('#tab-3-content'), \"2010-01-01\", \"2023-01-01\")\r\n\r\n    d3.select('#tab-3-content #date-control-refresh').on('click', function() {\r\n        const start = d3.select('#date-start-control').property('value')\r\n        const end = d3.select('#date-end-control').property('value')\r\n\r\n        console.log(start, end)\r\n        chord.rebuild(d3.select('#tab-3-content'), chordData, start, end)\r\n        onglet3.rebuild(d3.select('#tab-3-content'), start, end)\r\n    })\r\n\r\n})(d3)\r\n\r\n$('.tab-button').click(function () {\r\n    if (!$(this).hasClass('tab-button-active')) {\r\n        const tab = $(this).data('tab')\r\n    \r\n        $('button.tab-button').removeClass('tab-button-active')\r\n        $(this).addClass('tab-button-active')\r\n    \r\n        $('.tab-content').removeClass('visible-tab')\r\n        $(`.tab-content#tab-${tab}-content`).addClass('visible-tab')\r\n    }\r\n})"]}